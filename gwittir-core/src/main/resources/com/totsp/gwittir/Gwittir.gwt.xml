<?xml version="1.0" encoding="UTF-8"?>

<module>
    <!-- Inherit the core Web Toolkit stuff.                  -->
    <inherits name='com.google.gwt.user.User'/>
    <inherits name='com.google.gwt.i18n.I18N'/>
    <inherits name='com.google.gwt.gears.Gears'/>
    <inherits name='com.googlecode.gwtx.Java'/>
    <source path="client" />
    <generate-with
        class="com.totsp.gwittir.rebind.beans.IntrospectorGenerator" >
        <when-type-assignable
            class="com.totsp.gwittir.client.beans.Introspector" />
    </generate-with>
    <generate-with
        class="com.totsp.gwittir.rebind.stream.StreamClientGenerator" >
        <when-type-assignable
            class="com.totsp.gwittir.client.stream.StreamingService" />
    </generate-with>
    <replace-with
        class="com.totsp.gwittir.client.fx.rebind.OpacitySetterIE6">
        <when-type-is 
            class="com.totsp.gwittir.client.fx.rebind.OpacitySetter" />
        <when-property-is name="user.agent" value="ie6"/>
    </replace-with>
    <replace-with
        class="com.totsp.gwittir.client.fx.rebind.ReflectionIE6">
        <when-type-is 
            class="com.totsp.gwittir.client.fx.rebind.Reflection" />
        <when-property-is name="user.agent" value="ie6"/>
    </replace-with>
    <replace-with
        class="com.totsp.gwittir.client.fx.rebind.DimensionsIE6">
        <when-type-is 
            class="com.totsp.gwittir.client.fx.rebind.Dimensions" />
        <when-property-is name="user.agent" value="ie6"/>
    </replace-with>
    <define-property name="gwittir.windowcontext" values="gears,domstorage,userdata,html5" />
    <property-provider name="gwittir.windowcontext">
        <![CDATA[
        if (typeof GearsFactory != 'undefined') {
            return "gears";
        }
        try {
          var gears = new ActiveXObject('Gears.Factory');
          var db = gears.create('beta.database');
          db.open('database-test');
          alert("ActiveX");
            
          return "gears";
        } catch (e) {
          if ((typeof navigator.mimeTypes != 'undefined')
               && navigator.mimeTypes["application/x-googlegears"]) {
            return "gears";
          }
        }
        if(navigator.userAgent.indexOf("MSIE") != -1 ) {
        	return "userdata";
        }
        if(navigator.userAgent.indexOf("Safari") != -1 ){
        	return "html5";
        }
		if(window.globalStorage || window.localStorage){
	    	return "domstorage";
	   	}
	   	alert("Did not find a local storage type.");
	   	return "unknown";
        ]]>
    </property-provider>
    <replace-with
        class="com.totsp.gwittir.client.util.impl.WindowContextPersisterGears">
        <when-type-is
            class="com.totsp.gwittir.client.util.impl.WindowContextPersister" />
        <when-property-is name="gwittir.windowcontext" value="gears"/>
    </replace-with>
    <replace-with
        class="com.totsp.gwittir.client.util.impl.WindowContextPersisterFirefox">
        <when-type-is
            class="com.totsp.gwittir.client.util.impl.WindowContextPersister" />
        <when-property-is name="gwittir.windowcontext" value="domstorage"/>
    </replace-with>
    <replace-with
        class="com.totsp.gwittir.client.util.impl.WindowContextPersisterMSIE">
        <when-type-is
            class="com.totsp.gwittir.client.util.impl.WindowContextPersister" />
        <when-property-is name="gwittir.windowcontext" value="userdata"/>
    </replace-with>
    <replace-with
        class="com.totsp.gwittir.client.util.impl.WindowContextPersisterHTML5">
        <when-type-is
            class="com.totsp.gwittir.client.util.impl.WindowContextPersister" />
        <when-property-is name="gwittir.windowcontext" value="html5"/>
    </replace-with>

</module>
